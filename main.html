<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK-Auth: Data Flow Analysis</title>
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@300;450;700&display=swap" rel="stylesheet">
    <style>
        :root { --yonsei-blue: #003876; --gold: #d4af37; --supabase: #3ecf8e; --render: #46e3b7; --bg: #f4f7f9; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        header { background: var(--yonsei-blue); color: white; padding: 40px 20px; text-align: center; border-bottom: 5px solid var(--gold); position: relative; }
        .logout-btn { position: absolute; top: 20px; right: 20px; padding: 8px 16px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.4); border-radius: 4px; cursor: pointer; transition: 0.3s; }
        .logout-btn:hover { background: rgba(255,255,255,0.2); }

        .container { max-width: 1100px; margin: 40px auto; padding: 0 20px; }
        section { background: white; border-radius: 16px; padding: 40px; margin-bottom: 30px; box-shadow: 0 8px 30px rgba(0,0,0,0.05); }
        h2 { color: var(--yonsei-blue); border-left: 5px solid var(--gold); padding-left: 15px; margin-bottom: 30px; font-size: 1.5rem; }

        /* 프로세스 맵 스타일 */
        .process-box { border: 1px solid #eee; border-radius: 12px; padding: 25px; margin-bottom: 20px; background: #fff; position: relative; }
        .process-title { font-weight: 700; color: var(--yonsei-blue); margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        
        .data-flow { display: flex; align-items: center; gap: 15px; background: #f8f9fa; padding: 15px; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 0.9rem; margin-top: 10px; flex-wrap: wrap; }
        .data-tag { background: #eef2f7; color: #444; padding: 4px 10px; border-radius: 4px; border: 1px solid #d1d9e4; font-weight: 600; }
        .arrow-text { color: var(--yonsei-blue); font-weight: bold; font-size: 1.1rem; }

        /* 내부 연산 박스 */
        .internal-op { margin-top: 15px; padding: 12px; background: #fff5f5; border-radius: 6px; font-size: 0.85rem; border: 1px dashed #feb2b2; }

        /* 상단 배지 */
        .success-banner { background: #e7f9ed; border: 1px solid var(--supabase); color: #1e7e34; padding: 20px; border-radius: 12px; text-align: center; font-weight: 700; margin-bottom: 30px; }
        
        /* 안내문 및 푸터 */
        .notice-box { text-align: center; padding: 30px; color: #718096; line-height: 1.6; }
        .notice-box p { margin: 5px 0; font-size: 0.95rem; }
        .contact { font-size: 0.85rem; color: #a0aec0; margin-top: 15px; }
    </style>
</head>
<body>

<header>
    <button class="logout-btn" onclick="location.href='index.html'">LOGOUT</button>
    <h1>ZK-Auth 작동 방식</h1>
    <div class="system-status" id="welcomeUser">인증 시스템 가동 중</div>
</header>

<div class="container">
    
    <div style="background: #e7f9ed; border: 1px solid #bee3f8; color: #2b6cb0; padding: 12px; border-radius: 8px; text-align: center; font-size: 0.9rem; margin-bottom: 15px; font-weight: 500;">
        해당 페이지는 <b>PC 환경</b>에 최적화되어 있습니다.
    </div>

    <section>
        <h2>Step 0. What is zk-SNARKs?</h2>
        <p style="color: #666; margin-bottom: 20px;"><b>zk-SNARKs</b> 아키텍쳐</p>
        
        <div style="width: 100%; max-width: 850px; margin: 0 auto; background: #fff; border: 1px solid #edf2f7; border-radius: 12px; padding: 20px;">
            <svg viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg" style="width: 100%; height: auto;">
                <rect x="325" y="10" width="150" height="60" rx="10" fill="#f8f9fa" stroke="#333" stroke-width="1.5"/>
                <text x="400" y="45" text-anchor="middle" font-weight="700" font-size="14" fill="#003876">Trusted Setup</text>
                
                <rect x="100" y="170" width="180" height="110" rx="15" fill="#eef4ff" stroke="#003876" stroke-width="2"/>
                <text x="190" y="220" text-anchor="middle" font-weight="700" font-size="16" fill="#003876">Prover</text>
                <text x="190" y="245" text-anchor="middle" font-size="12" fill="#666">(사용자 브라우저)</text>
                
                <rect x="520" y="170" width="180" height="110" rx="15" fill="#f0fff4" stroke="#2e7d32" stroke-width="2"/>
                <text x="610" y="220" text-anchor="middle" font-weight="700" font-size="16" fill="#2e7d32">Verifier</text>
                <text x="610" y="245" text-anchor="middle" font-size="12" fill="#666">(Render Node 서버)</text>
                
                <path d="M 325 40 Q 190 40 190 160" fill="none" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrow)"/>
                <text x="180" y="100" font-size="11" font-weight="600" fill="#4a5568">Prover Key (zkey)</text>
                
                <path d="M 475 40 Q 610 40 610 160" fill="none" stroke="#a0aec0" stroke-width="1.5" stroke-dasharray="4" marker-end="url(#arrow)"/>
                <text x="540" y="100" font-size="11" font-weight="600" fill="#4a5568">Verifier Key (vKey)</text>
                
                <line x1="10" y1="225" x2="90" y2="225" stroke="#e53e3e" stroke-width="2" marker-end="url(#arrow)"/>
                <text x="45" y="210" text-anchor="middle" font-size="11" font-weight="700" fill="#e53e3e">비밀번호(PW)</text>
                
                <line x1="280" y1="225" x2="510" y2="225" stroke="#2d3748" stroke-width="2.5" marker-end="url(#arrow)"/>
                <text x="395" y="210" text-anchor="middle" font-size="14" font-weight="700" fill="#2d3748">Proof (수학적 증명)</text>
                
                <line x1="700" y1="225" x2="785" y2="225" stroke="#2e7d32" stroke-width="2" marker-end="url(#arrow)"/>
                <text x="745" y="210" text-anchor="middle" font-size="12" font-weight="700" fill="#2e7d32">SUCCESS</text>
                
                <path d="M 400 380 Q 190 380 190 290" fill="none" stroke="#3ecf8e" stroke-width="2" marker-end="url(#arrow)"/>
                <path d="M 400 380 Q 610 380 610 290" fill="none" stroke="#3ecf8e" stroke-width="2" marker-end="url(#arrow)"/>
                <text x="400" y="370" text-anchor="middle" font-size="13" fill="#276749" font-weight="700">Public Info (DB 내 해시값)</text>

                <defs>
                    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="5" orient="auto">
                        <path d="M0,0 L10,5 L0,10 Z" fill="#4a5568" />
                    </marker>
                </defs>
            </svg>
        </div>
        
        <div style="margin-top: 25px; padding: 20px; background: #f7fafc; border-radius: 8px; font-size: 0.9rem; line-height: 1.7; color: #4a5568; border: 1px solid #edf2f7;">
            • <b>Prover(증명자):</b> 사용자의 브라우저입니다. 비밀번호를 알고 있다는 사실을 수학적으로 증명합니다.<br>
            • <b>Verifier(검증자):</b> Render 서버입니다. 비밀번호를 받지 않고 증명서의 유효성만 판단합니다.<br>
            • <b>Privacy:</b> 빨간색 화살표로 표시된 <b>비밀번호</b>는 Prover 영역을 벗어나지 않습니다.
        </div>
    </section>

    <section>
        <h2>Step 1. 회원가입 (Registration)</h2>
        <div class="process-box">
            <div class="process-title">데이터 저장 단계</div>
            <p>입력한 비밀번호를 <b>Poseidon Hash</b>로 변환하여 DB에 저장합니다.</p>
            <div class="data-flow">
                <span class="data-tag">Browser</span> 
                <span class="arrow-text">── { ID, Poseidon(PW) } ──▶</span> 
                <span class="data-tag" style="background: #e6fffa; border-color: var(--supabase);">Supabase DB</span>
            </div>
            <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">* 서버는 실제 비밀번호의 원본을 알 수 없으며 Hash값만 저장합니다.</p>
        </div>
    </section>

    <section>
        <h2>Step 2. 로그인 및 증명 생성 (Proving)</h2>
        <div class="process-box">
            <div class="process-title">브라우저 내 증명 연산 (Client-side)</div>
            <p>로그인 요청 시 ID에 대응된 Hash(PW)를 DB에서 로드한 후, 사용자의 기기 내에서 수학적 증명을 생성합니다.</p>
            <div class="data-flow">
                <span class="data-tag" style="background: #e6fffa;">Supabase</span> 
                <span class="arrow-text">── [SavedHash] ──▶</span> 
                <span class="data-tag" style="background: #fff9db; border-color: var(--gold);">Browser (snarkjs)</span>
            </div>
            <div class="internal-op" style="background: #f0f5ff; border-color: #bee3f8;">
                <b>내부 연산:</b> prove(입력PW, SavedHash, Prover.zkey) ➔ <span style="color: #3182ce; font-weight: bold;">Proof</span> 생성 완료
            </div>
        </div>
    </section>

    <section>
        <h2>Step 3. 검증 및 로그인 성공 (Verification)</h2>
        <div class="process-box">
            <div class="process-title">서버 증명 검증 (Server-side)</div>
            <p>생성된 증명서를 <b>Render Node 서버</b>에 전송하여 검증을 진행합니다.</p>
            <div class="data-flow">
                <span class="data-tag" style="background: #fff9db;">Browser</span> 
                <span class="arrow-text">── [Proof, PublicSignals] ──▶</span> 
                <span class="data-tag" style="background: #e3fafd; border-color: var(--render);">Render Server</span>
            </div>
            <div class="internal-op" style="background: #f0f5ff; border-color: #bee3f8;">
                <b>내부 연산:</b> verify(Proof, PublicSignals, Verifier.vkey) ➔ <span style="color: #3182ce; font-weight: bold;">True</span> 반환
            </div>
            <div class="data-flow" style="margin-top: 15px;">
                <span class="data-tag" style="background: #e3fafd;">Render Server</span> 
                <span class="arrow-text">── "Success Token" ──▶</span> 
                <span class="data-tag">Browser</span>
            </div>
        </div>
    </section>

    <div class="notice-box">
        <p>본 사이트는 <b>zk-SNARKs</b> 기술 구현을 위해 제작된 데모 버전입니다.</p>
        <div class="contact">
            Contact: <b>sunjun0411@yonsei.ac.kr</b>
        </div>
    </div>

</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get('user') || 'User';
    document.getElementById('welcomeUser').textContent = `${username.toUpperCase()} 님의 인증 데이터 분석`;
</script>

</body>
</html>